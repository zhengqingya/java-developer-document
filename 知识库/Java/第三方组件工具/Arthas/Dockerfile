FROM registry.cn-hangzhou.aliyuncs.com/zhengqing/openjdk:8-jdk-alpine

# ç»´æŠ¤è€…ä¿¡æ¯
MAINTAINER zhengqingya

# è®¾ç½®çŽ¯å¢ƒå˜é‡
ENV JAVA_OPTS "-XX:+UseG1GC -Xms100m -Xmx100m -Xmn32m -XX:MetaspaceSize=100m -XX:MaxMetaspaceSize=100m -XX:MaxGCPauseMillis=200 -XX:ParallelGCThreads=8 -Ddefault.client.encoding=UTF-8 -Dfile.encoding=UTF-8 -Duser.language=Zh -Duser.region=CN -Dspring.profiles.active=xx -Dspring.cloud.nacos.discovery.server-addr=xx -Dspring.cloud.nacos.discovery.username=nacos -Dspring.cloud.nacos.discovery.password=nacos"

# copy arthas
COPY --from=hengyunabc/arthas:latest /opt/arthas /opt/arthas

# æ·»åŠ jaråŒ…åˆ°å®¹å™¨ä¸­
ADD *.jar /home/

# å¯¹å¤–æš´æ¼çš„ç«¯å£å·
# [æ³¨ï¼šEXPOSEæŒ‡ä»¤åªæ˜¯å£°æ˜Žå®¹å™¨è¿è¡Œæ—¶æä¾›çš„æœåŠ¡ç«¯å£ï¼Œç»™è¯»è€…çœ‹æœ‰å“ªäº›ç«¯å£ï¼Œåœ¨è¿è¡Œæ—¶åªä¼šå¼€å¯ç¨‹åºè‡ªèº«çš„ç«¯å£ï¼ï¼]
EXPOSE 5000
EXPOSE 50001

# RUN ðŸƒðŸƒðŸƒ
CMD echo "****** Run ... " & \
    nohup java -jar ${JAVA_OPTS} /home/app.jar >> /home/app.log 2>&1 & \
    echo "****** æŸ¥çœ‹æ—¥å¿—..." & \
    tail -f /home/app.log
